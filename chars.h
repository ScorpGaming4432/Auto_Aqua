/**
 * ============================================================================
 * CHARS.H - Master Glyph Library with Unicode Mapping
 * ============================================================================
 */

#ifndef CUSTOM_CHARS_H
#define CUSTOM_CHARS_H

#pragma once
#include <Arduino.h>
#include <avr/pgmspace.h>
#include "display.h"

namespace Glyphs {

struct UnicodeGlyph {
  uint16_t id;      // Unicode value
  uint8_t data[8];  // 5x8 bitmask
};

const UnicodeGlyph MASTER_LIBRARY[] PROGMEM = {
  // Polish
  { 0x0105, { 0, 0, 14, 1, 15, 17, 15, 2 } },      // ą
  { 0x0107, { 2, 4, 14, 16, 16, 17, 14, 0 } },     // ć
  { 0x0119, { 0, 0, 14, 17, 31, 16, 14, 2 } },     // ę
  { 0x0142, { 12, 4, 6, 12, 4, 4, 14, 0 } },       // ł
  { 0x00F3, { 2, 4, 14, 17, 17, 17, 14, 0 } },     // ó
  { 0x015B, { 2, 4, 14, 16, 14, 1, 30, 0 } },      // ś
  { 0x017A, { 2, 4, 31, 2, 4, 8, 31, 0 } },        // ź
  { 0x017C, { 4, 0, 31, 2, 4, 8, 31, 0 } },        // ż

  // German/French/Spanish
  { 0x00FC, { 10, 0, 17, 17, 17, 17, 14, 0 } },     // ü
  { 0x00E4, { 10, 0, 14, 1, 15, 17, 15, 0 } },      // ä
  { 0x00F6, { 10, 0, 14, 17, 17, 17, 14, 0 } },     // ö
  { 0x00E9, { 2, 4, 14, 17, 31, 16, 14, 0 } },      // é
  { 0x00E8, { 8, 4, 14, 17, 31, 16, 14, 0 } },      // è
  { 0x00EA, { 4, 10, 14, 17, 31, 16, 14, 0 } },     // ê
  { 0x00E7, { 0, 14, 16, 16, 14, 4, 12, 0 } },      // ç
  { 0x00E0, { 8, 4, 14, 1, 15, 17, 15, 0 } },       // à
  { 0x00F1, { 13, 19, 18, 18, 18, 18, 18, 0 } },    // ñ
  { 0x00ED, { 2, 4, 12, 4, 4, 4, 14, 0 } },         // í
  { 0x00E1, { 2, 4, 14, 1, 15, 17, 15, 0 } },       // á
  { 0x00FA, { 2, 4, 17, 17, 17, 17, 14, 0 } },      // ú

  // Russian
  { 0x0413, { 31, 16, 16, 16, 16, 16, 16, 0 } },   // Г
  { 0x0414, { 15, 9, 9, 9, 9, 31, 17, 0 } },       // Д
  { 0x0416, { 17, 17, 21, 14, 21, 17, 17, 0 } },   // Ж
  { 0x0417, { 14, 17, 1, 6, 1, 17, 14, 0 } },      // З
  { 0x0418, { 17, 17, 19, 21, 25, 17, 17, 0 } },   // И
  { 0x0419, { 10, 4, 17, 19, 21, 25, 17, 0 } },    // Й
  { 0x041B, { 7, 9, 9, 9, 9, 9, 17, 0 } },         // Л
  { 0x041F, { 31, 17, 17, 17, 17, 17, 17, 0 } },   // П
  { 0x042E, { 18, 18, 22, 18, 22, 18, 18, 0 } },   // Ю
  { 0x042F, { 15, 17, 17, 15, 5, 9, 17, 0 } },     // Я
  { 0x0431, { 14, 16, 30, 17, 17, 17, 14, 0 } },   // б
  { 0x044B, { 17, 17, 25, 21, 25, 17, 17, 0 } },   // ы
  { 0x044D, { 14, 1, 15, 1, 14, 0, 0, 0 } },       // э
  { 0x0447, { 17, 17, 15, 1, 1, 1, 1, 0 } },       // ч

  // Czech/Turkish
  { 0x010D, { 10, 4, 14, 16, 16, 17, 14, 0 } },     // č
  { 0x0161, { 10, 4, 14, 16, 14, 1, 30, 0 } },      // š
  { 0x017E, { 10, 4, 31, 2, 4, 8, 31, 0 } },        // ž
  { 0x00FD, { 2, 4, 17, 17, 15, 1, 14, 0 } },       // ý
  { 0x011B, { 10, 4, 14, 17, 31, 16, 14, 0 } },     // ě
  { 0x011F, { 10, 0, 15, 17, 19, 17, 15, 0 } },     // ğ
  { 0x015F, { 14, 16, 14, 1, 30, 4, 8, 0 } },       // ş
  { 0x0131, { 0, 0, 12, 4, 4, 4, 14, 0 } }          // ı
};

constexpr uint8_t LIBRARY_SIZE = sizeof(MASTER_LIBRARY) / sizeof(MASTER_LIBRARY[0]);

const uint8_t DROP_CHARS[4][8] PROGMEM = {
  { 4, 4, 14, 14, 14, 31, 31, 31 }, { 1, 2, 2, 2, 2, 3, 1, 0 },
  { 31, 31, 31, 31, 31, 15, 3, 31 }, { 16, 24, 24, 24, 24, 24, 16, 0 }
};

inline void animateIcon(uint8_t slots[4], uint8_t revealRows, uint8_t scratchBuf[]) {
  for (uint8_t i = 0; i < 4; i++) {
    for (uint8_t row = 0; row < 8; row++) {
      uint8_t pix = pgm_read_byte(&DROP_CHARS[i][row]);
      if (row < 8 - revealRows) pix = 0;
      scratchBuf[row] = pix;
    }
    lcd.createChar(slots[i], scratchBuf);
  }
}

} // namespace Glyphs

#endif
